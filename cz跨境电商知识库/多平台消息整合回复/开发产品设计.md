# 完整开发提示词：多平台跨境电商消息整合回复系统
## 核心开发目标
基于Java（后端）+ MySQL（数据库）+ Vue（前端）开发一套**多平台跨境电商客户消息整合与智能回复系统**，核心整合Amazon、eBay、Shopify三大平台的客户消息，支持网页端（适配手机端响应式）访问，具备「英文消息自动翻译为中文、中文回复自动翻译为英文」的核心翻译能力，实现多平台消息统一聚合、统一回复、状态同步，满足跨境卖家高效处理多平台客户咨询的需求。

## 一、技术栈强制要求
### 1. 后端技术栈
- 基础框架：Spring Boot 3.x（核心框架）、Spring MVC（请求处理）、Spring Security（权限控制）
- 持久层：MyBatis-Plus（ORM框架）、MySQL 8.0（数据库）
- 接口规范：RESTful API、Swagger/OpenAPI 3.0（接口文档）
- 消息处理：RabbitMQ（异步处理平台API调用、消息推送）
- 第三方集成：集成主流翻译API（如百度翻译/谷歌翻译API，支持中英文互译）
- 工具类：Lombok（简化代码）、Hutool（通用工具）、JJWT（Token生成与验证）
- 部署适配：支持Docker容器化部署

### 2. 前端技术栈
- 核心框架：Vue 3 + Vite（构建工具）、Pinia（状态管理）、Vue Router（路由）
- UI组件库：Element Plus（适配响应式）、Vant（补充移动端适配组件）
- 翻译交互：集成翻译SDK，支持实时翻译/手动触发翻译
- 响应式适配：采用REM/Viewport布局，兼容PC端（1920/1440分辨率）、移动端（375/414分辨率）
- 其他：Axios（请求封装）、Echarts（数据看板可视化）、Markdown编辑器（回复内容编辑）

### 3. 数据库
- 主数据库：MySQL 8.0（InnoDB引擎）
- 索引设计：针对消息表的「平台类型、买家ID、订单ID、创建时间」建立联合索引
- 数据加密：对平台授权令牌（access_token/refresh_token）、买家隐私信息进行加密存储

## 二、核心功能需求（优先级从高到低）
### 模块1：平台账号管理
1. 支持Amazon、eBay、Shopify账号的OAuth 2.0授权接入，流程如下：
   - 前端展示各平台授权入口，用户点击后跳转至平台授权页面；
   - 后端接收授权回调，获取并加密存储access_token、refresh_token，实现令牌自动刷新（过期前30分钟刷新）；
   - 支持多账号管理（同一平台可绑定多个店铺账号），标注账号名称/店铺ID，支持启用/禁用。
2. 平台API配额监控：展示各账号API剩余调用次数、今日已调用次数，超出配额时触发告警。

### 模块2：消息聚合与同步
1. 消息拉取：
   - 优先通过Webhook接收各平台新消息（Amazon SP-API、eBay Notify、Shopify Webhook），验证签名后解析；
   - 兜底方案：定时任务（每1分钟）拉取未同步的消息，避免Webhook丢失；
   - 支持拉取的消息类型：买家站内信、订单咨询、售后问题、评价留言（需关联订单ID/买家ID）。
2. 消息标准化：将各平台异构消息转换为统一模型，核心字段如下：
   ```
   {
     id: 自增ID,
     platformType: 平台类型（AMAZON/EBAY/SHOPIFY）,
     platformMsgId: 平台原生消息ID,
     shopId: 绑定的店铺ID,
     buyerId: 买家唯一标识（加密存储）,
     orderId: 关联订单ID,
     msgContent: 原始消息内容,
     msgTranslateContent: 翻译后的内容（英文→中文）,
     msgTime: 消息发送时间,
     msgStatus: 状态（未读/已读/已回复）,
     createTime: 系统接收时间,
     updateTime: 状态更新时间
   }
   ```
3. 会话聚合：按「platformType + buyerId + orderId」聚合消息，同一买家针对同一订单的多条消息合并为一个会话，展示消息上下文。
4. 状态同步：用户在系统中标记「已读/已回复」后，同步至对应平台（调用平台API更新消息状态）。

### 模块3：翻译功能（核心）
1. 自动翻译：接收英文消息后，自动调用翻译API转换为中文，展示在消息详情页（标注「机器翻译」）；
2. 手动翻译：支持用户点击「重新翻译」触发二次翻译，或手动修改翻译结果；
3. 回复翻译：用户输入中文回复内容后，自动翻译为英文（可手动编辑翻译结果），确保符合各平台语言规范；
4. 翻译记录：保存每条消息/回复的翻译前后内容，支持回溯。

### 模块4：统一回复管理
1. 回复编辑：
   - 支持富文本/Markdown编辑，适配各平台格式限制（如Amazon禁止外部链接、eBay限制字符数）；
   - 内置变量替换（如{{orderId}}、{{shopName}}），自动填充订单/店铺信息；
   - 支持回复模板管理（新增/编辑/删除/复用，按平台分类）。
2. 回复发送：
   - 选择聚合会话后，输入中文内容（自动翻译为英文），点击发送后调用对应平台API发送回复；
   - 发送失败时（如API配额不足、格式违规），展示错误提示并支持重试；
   - 发送成功后，更新消息状态为「已回复」，记录回复日志（发送时间、内容、翻译内容、是否成功）。
3. 批量操作：支持批量标记已读、批量发送模板回复（仅限同平台同类型消息）。

### 模块5：响应式前端适配
1. PC端：
   - 左侧：会话列表（按未读优先排序，标注平台/订单/买家）；
   - 中间：消息详情（原始内容+翻译内容，时间轴展示）；
   - 右侧：回复编辑区+模板选择区。
2. 移动端：
   - 底部Tab切换「会话列表/回复中心/账号管理」；
   - 会话列表页：下拉刷新、上拉加载更多；
   - 消息详情页：适配屏幕宽度，翻译内容与原始内容分栏/换行展示，回复框自适应高度。

### 模块6：基础辅助功能
1. 消息提醒：新消息触发浏览器通知（PC端）、页面红点提示（全端）；
2. 数据看板：展示各平台消息量、回复时效（平均回复时长）、翻译使用率、回复成功率等可视化图表；
3. 日志管理：记录API调用日志、消息同步日志、回复日志、翻译日志，支持按时间/平台/关键词查询；
4. 权限管理：支持多角色（超级管理员/店铺管理员/客服），超级管理员可分配店铺权限，客服仅可处理授权范围内的消息。

## 三、非功能需求
1. 性能要求：
   - 消息同步延迟≤5分钟（Webhook）/≤1分钟（定时拉取）；
   - 单店铺单日1000条消息下，页面加载时间≤2秒；
   - API调用频率控制：严格遵守各平台限制（Amazon≤1次/秒、Shopify≤2次/秒）。
2. 合规要求：
   - 遵守各平台API协议（禁止爬取、数据仅用于自身业务）；
   - 符合GDPR/CCPA：支持买家数据删除、隐私信息加密、数据留存周期配置（默认6个月）；
   - 翻译内容不得违反平台规则（如避免敏感词）。
3. 安全要求：
   - 前端：防XSS攻击（输入内容过滤）、CSRF防护（Token验证）；
   - 后端：接口鉴权（JWT Token）、API调用IP白名单、数据库防注入；
   - 数据：定期备份（每日全量备份，保留7天）。
4. 兼容性：
   - 前端：兼容Chrome/Firefox/Safari（PC端）、微信浏览器/Chrome移动端；
   - 后端：兼容Linux/Windows服务器，支持Docker部署。

## 四、数据库设计（核心表）
### 1. 平台账号表（platform_account）
| 字段名          | 类型         | 备注                     |
|-----------------|--------------|--------------------------|
| id              | bigint       | 主键                     |
| platform_type   | varchar(20)  | 平台类型（AMAZON/EBAY/SHOPIFY） |
| shop_name       | varchar(100) | 店铺名称（自定义）|
| shop_id         | varchar(64)  | 平台店铺ID               |
| client_id       | varchar(128) | 平台应用ID               |
| client_secret   | varchar(128) | 平台应用密钥（加密）|
| access_token    | varchar(512) | 访问令牌（加密）|
| refresh_token   | varchar(512) | 刷新令牌（加密）|
| token_expire_at | datetime     | 令牌过期时间             |
| status          | tinyint      | 状态（0-禁用，1-启用）|
| create_time     | datetime     | 创建时间                 |
| update_time     | datetime     | 更新时间                 |

### 2. 消息表（customer_message）
| 字段名               | 类型         | 备注                     |
|----------------------|--------------|--------------------------|
| id                   | bigint       | 主键                     |
| platform_type        | varchar(20)  | 平台类型                 |
| platform_msg_id      | varchar(64)  | 平台原生消息ID           |
| account_id           | bigint       | 关联platform_account.id  |
| buyer_id             | varchar(128) | 买家ID（加密）|
| order_id             | varchar(64)  | 关联订单ID               |
| original_content     | text         | 原始消息内容             |
| translate_content    | text         | 翻译后内容               |
| msg_time             | datetime     | 消息发送时间             |
| msg_status           | varchar(20)  | 状态（UNREAD/READ/REPLIED） |
| translate_status     | tinyint      | 翻译状态（0-未翻译，1-已翻译，2-手动修改） |
| create_time          | datetime     | 系统接收时间             |
| update_time          | datetime     | 更新时间                 |

### 3. 回复记录表（reply_record）
| 字段名               | 类型         | 备注                     |
|----------------------|--------------|--------------------------|
| id                   | bigint       | 主键                     |
| message_id           | bigint       | 关联customer_message.id  |
| original_reply       | text         | 原始回复内容（中文）|
| translate_reply      | text         | 翻译后回复内容（英文）|
| send_status          | tinyint      | 发送状态（0-失败，1-成功） |
| send_time            | datetime     | 发送时间                 |
| error_msg            | varchar(255) | 发送失败原因             |
| operator_id          | bigint       | 操作人ID                 |
| create_time          | datetime     | 创建时间                 |

### 4. 回复模板表（reply_template）
| 字段名               | 类型         | 备注                     |
|----------------------|--------------|--------------------------|
| id                   | bigint       | 主键                     |
| template_name        | varchar(100) | 模板名称                 |
| platform_type        | varchar(20)  | 适用平台（ALL/AMAZON/EBAY/SHOPIFY） |
| original_content     | text         | 模板原始内容（中文）|
| translate_content    | text         | 模板翻译内容（英文）|
| create_time          | datetime     | 创建时间                 |
| update_time          | datetime     | 更新时间                 |

## 五、交付物要求
1. 代码交付：
   - 后端：完整的Maven/Gradle项目，代码注释覆盖率≥80%，符合阿里巴巴Java开发规范；
   - 前端：完整的Vue项目，包含package.json、README.md（启动/打包说明）；
   - 数据库：SQL脚本（建表+初始化数据）、ER图。
2. 文档交付：
   - 接口文档：基于Swagger生成的RESTful API文档；
   - 部署文档：Docker部署步骤、环境配置说明、平台授权流程；
   - 使用手册：前端操作指南（PC端/移动端）、常见问题排查；
   - 设计文档：架构设计图、数据库设计文档、翻译流程说明。
3. 测试交付：
   - 单元测试：后端核心接口单元测试覆盖率≥70%；
   - 功能测试：测试用例（覆盖平台授权、消息同步、翻译、回复核心流程）；
   - 兼容性测试：PC/移动端兼容性测试报告。

## 六、开发规范
1. 编码规范：
   - 后端：遵循阿里巴巴Java开发手册（最新版），类名使用UpperCamelCase，方法名使用lowerCamelCase，常量全大写+下划线；
   - 前端：遵循Vue官方风格指南，组件名使用PascalCase，API请求封装统一管理，翻译逻辑抽离为独立工具类。
2. 命名规范：
   - 数据库表名：小写+下划线（如customer_message）；
   - 接口路径：/api/v1/[模块]/[功能]（如/api/v1/account/auth）；
   - 前端路由：/[模块]/[功能]（如/msg/list）。
3. 异常处理：
   - 后端：全局异常拦截，统一返回格式（{code: 状态码, msg: 提示, data: 数据}）；
   - 前端：统一错误提示（Toast/弹窗），翻译失败时降级展示原始内容。

## 七、核心流程示例（Amazon消息回复）
1. 用户在系统绑定Amazon店铺，完成OAuth授权；
2. Amazon有新买家消息时，Webhook推送至系统后端；
3. 后端解析消息，调用翻译API将英文转为中文，存储至customer_message表，状态标记为UNREAD；
4. 前端实时拉取未读消息，在会话列表展示，标注「Amazon+订单ID+未读」；
5. 用户点击会话，查看原始英文消息+中文翻译内容；
6. 用户输入中文回复内容，系统自动翻译为英文，展示翻译结果（可手动编辑）；
7. 用户点击「发送」，后端调用Amazon SP-API发送回复，更新消息状态为REPLIED；
8. 发送结果同步至前端，记录回复日志至reply_record表；
9. 数据看板实时更新该店铺的回复成功率、翻译使用率。

请基于上述要求，完成该系统的全流程开发，确保核心功能可用、性能达标、适配多端，且严格遵守各平台API协议与数据合规要求。