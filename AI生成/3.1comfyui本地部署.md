# ComfyUI本地部署完整指南

## 一、系统准备

### 1. 硬件要求
- **GPU**：NVIDIA推荐≥RTX 1080Ti(8GB显存)；AMD需ROCm支持；CPU可用但速度慢 
- **内存**：≥16GB(推荐32GB) 
- **存储**：≥40GB(推荐100GB+ SSD) 

### 2. 软件要求
- **操作系统**：Windows 10+/Linux/macOS(支持Apple Silicon) 
- **Python**：推荐3.12(支持3.13但部分插件可能不兼容) 
- **CUDA**：NVIDIA用户推荐11.8或12.1 

## 二、安装方法(推荐)

### Windows用户：使用便携版(最简单)

1. 下载官方Windows便携包：  
   ```
   https://github.com/comfyanonymous/ComfyUI/releases/latest
   ```
   (选择带"Windows portable"的zip文件) 

2. 解压到全英文路径(如D:\ComfyUI) 

3. 启动：  
   - **NVIDIA GPU**：双击`run_nvidia_gpu.bat`
   - **CPU模式**：双击`run_cpu.bat` 

4. 浏览器自动打开`http://127.0.0.1:8188`，开始使用 

### Linux/macOS用户：手动安装

1. 安装依赖：
   ```bash
   # Linux
   sudo apt update
   sudo apt upgrade -y
   
   # macOS(Apple Silicon)
   brew update
   brew upgrade
   ```

2. 安装Python(推荐3.12)：
   ```bash
   # Linux/macOS
   wget https://www.python.org/ftp/python/3.12.10/Python-3.12.10.tgz
   tar -xvf Python-3.12.10.tgz
   cd Python-3.12.10
   ./configure --enable-optimizations
   make -j$(nproc)
   sudo make install
   ```

3. 安装ComfyUI：
   ```bash
   git clone https://github.com/comfyanonymous/ComfyUI
   cd ComfyUI
   ```

4. 安装PyTorch(根据硬件选择)：
   ```bash
   # NVIDIA GPU
   pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
   
   # AMD GPU
   pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/rocm6.0
   
   # macOS(Apple Silicon)
   conda install pytorch-nightly::pytorch torchvision torchaudio -c pytorch-nightly
   ```

5. 安装ComfyUI依赖：
   ```bash
   pip install -r requirements.txt
   ```

6. 启动：
   ```bash
   python main.py
   ```

## 三、模型下载与管理

### 1. 下载模型
- **官方模型**：Hugging Face(需科学上网)
- **国内镜像**：
  - https://hf-mirror.com/ (Hugging Face镜像) 
  - https://www.liblib.art/ (国内模型平台) 

### 2. 模型存放路径

创建以下目录结构：
```
ComfyUI/
├── models/
│   ├── diffusion_models/  # 主模型(.ckpt/.safetensors)
│   ├── vae/             # VAE模型
│   ├── embeddings/      # Embedding模型
│   └── lora/            # LoRA模型
└── custom_nodes/        # 插件/自定义节点
```

**示例**：将下载的`realisticVisionV5.safetensors`放入`models/diffusion_models/` 

### 3. 添加自定义模型路径(可选)
复制`extra_model_paths.yaml.example`为`extra_model_paths.yaml`，编辑添加自定义路径 

## 四、性能优化(必看)

### 1. NVIDIA GPU优化

- **启用xFormers**(减少30-50%显存，提升20%速度)：
  - 在ComfyUI设置中勾选"Enable xFormers" 
  - 或启动时添加参数：`python main.py --xformers`

- **显存优化参数**(低显存必备)：
  ```
  # 低显存模式
  python main.py --lowvram
  
  # CPU运行VAE(节省显存)
  python main.py --cpu-vae
  
  # 普通显存+模型卸载
  python main.py --normalvram --enable-model-swap
  ```
  

### 2. 通用优化建议

- **使用SSD**：提高模型加载速度 
- **内存优化**：
  - Windows：设置虚拟内存到剩余空间>100GB的SSD分区 
  - Linux：使用`swapfile` 
- **关闭后台应用**：释放内存 

## 五、常见问题及解决

### 1. 启动失败

- **权限问题**：Windows以管理员身份运行；Linux/macOS添加执行权限 
- **依赖缺失**：
  ```bash
  # 重新安装依赖(使用国内源加速)
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
  ```
  

### 2. 模型加载失败

- 检查路径是否包含中文/特殊字符(必须全英文) 
- 确认模型文件完整(下载后校验哈希值) 
- 重启ComfyUI使新模型生效 

### 3. 浏览器无法访问

- 确认服务已启动(控制台显示`Running on http://0.0.0.0:8188`)
- 手动打开浏览器访问`http://127.0.0.1:8188` 

## 六、下一步建议

1. 下载并加载模型(如realisticVisionV5等高质量人像模型)
2. 尝试导入之前提供的多姿势模特生成工作流JSON
3. 探索自定义节点(如ControlNet、UltimateSDUpscale等)，增强功能

## 总结

ComfyUI部署分三步：下载安装→配置模型→优化性能。Windows用户推荐便携版，Linux/macOS用户使用手动安装。关键是合理管理模型路径和优化显存使用，确保流畅体验。

**立即行动**：下载对应系统的安装包，按步骤操作，10分钟内即可开始AI创作之旅！